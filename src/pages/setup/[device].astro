---
import Layout from '../../layouts/Layout.astro';
import { deviceData } from '../../data/devices';

export function getStaticPaths() {
  return Object.keys(deviceData).map(device => ({
    params: { device }
  }));
}

const { device } = Astro.params;
const data = deviceData[device as keyof typeof deviceData];

if (!data) {
  return Astro.redirect('/404');
}

const pageTitle = `${data.name} Setup Guide | NodakMesh`;
const pageDescription = `Complete setup guide for ${data.name}. DFU mode instructions, driver downloads, and post-flash configuration for MeshCore and Meshtastic firmware.`;
---

<Layout title={pageTitle} description={pageDescription}>
  <main class="pt-24 pb-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Back Navigation -->
      <div class="mb-8">
        <a href="/meshcore/devices" class="inline-flex items-center gap-2 text-[--color-text-secondary] hover:text-[--color-text-primary] transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Devices
        </a>
      </div>

      <!-- Header with Device Image -->
      <div class="flex flex-col md:flex-row gap-8 mb-12">
        <div class="md:w-1/3">
          <div class="bg-[--color-bg-secondary] rounded-2xl p-4 border border-[--color-border]">
            <img src={data.image} alt={data.name} class="w-full h-auto object-contain" />
          </div>
        </div>
        <div class="md:w-2/3">
          <h1 class="text-3xl sm:text-4xl font-bold text-[--color-text-primary] mb-4">
            {data.name}
          </h1>
          <div class="flex flex-wrap gap-4 mb-4">
            <span class="px-3 py-1 bg-[--color-accent]/10 text-[--color-accent] rounded-full text-sm font-medium">
              {data.chip}
            </span>
            <span class="px-3 py-1 bg-green-500/10 text-green-400 rounded-full text-sm font-medium">
              {data.price}
            </span>
          </div>
          <div class="flex gap-3">
            <a
              href={data.links.buy}
              target="_blank"
              rel="noopener noreferrer"
              class="btn-primary inline-flex items-center gap-2"
            >
              Buy Device
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </a>
            {data.links.docs && (
              <a
                href={data.links.docs}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-secondary inline-flex items-center gap-2"
              >
                Documentation
              </a>
            )}
          </div>
        </div>
      </div>

      <!-- IMPORTANT: Antenna Warning -->
      <div class="bg-red-500/10 border-2 border-red-500/50 rounded-2xl p-6 mb-8">
        <div class="flex items-start gap-4">
          <svg class="w-8 h-8 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <div>
            <h3 class="text-lg font-bold text-red-400 mb-2">IMPORTANT: Attach Antenna Before Powering On!</h3>
            <p class="text-[--color-text-secondary]">
              <strong class="text-red-300">Always connect an antenna to your device BEFORE plugging in USB or turning it on.</strong>
              Transmitting without an antenna can permanently damage the LoRa radio chip. Even a few seconds of transmission
              without an antenna can cause irreversible damage. This applies to flashing AND normal use.
            </p>
          </div>
        </div>
      </div>

      <!-- DFU Mode Instructions -->
      <div class="bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-2xl p-8 mb-8">
        <h2 class="text-2xl font-bold text-[--color-text-primary] mb-2">
          Step 1: Enter DFU/Bootloader Mode
        </h2>
        <p class="text-[--color-text-secondary] mb-4">
          <strong>Method:</strong> {data.dfu.method}
        </p>
        <ol class="space-y-3 mb-4">
          {data.dfu.steps.map((step: string, i: number) => (
            <li class="flex gap-3 text-[--color-text-secondary]">
              <span class="flex-shrink-0 w-7 h-7 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">{i + 1}</span>
              <span>{step}</span>
            </li>
          ))}
        </ol>
        {data.dfu.alternative && (
          <div class="bg-[--color-bg-primary]/50 rounded-lg p-4 mt-4">
            <p class="text-sm text-[--color-text-muted]">
              <strong>Note:</strong> {data.dfu.alternative}
            </p>
          </div>
        )}
      </div>

      <!-- Driver Information -->
      <div class="bg-[--color-bg-secondary] border border-[--color-border] rounded-2xl p-8 mb-8">
        <h2 class="text-2xl font-bold text-[--color-text-primary] mb-4">
          Step 2: Install Drivers (if needed)
        </h2>
        <div class="mb-4">
          <span class="text-lg font-medium text-[--color-text-primary]">{data.driver.name}</span>
          <p class="text-[--color-text-secondary] mt-1">{data.driver.needed}</p>
        </div>
        <div class="grid sm:grid-cols-3 gap-4">
          <div class="bg-[--color-bg-tertiary] rounded-xl p-4">
            <h4 class="font-medium text-[--color-text-primary] mb-2">Windows</h4>
            {data.driver.windows.startsWith('http') ? (
              <a href={data.driver.windows} target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline text-sm">
                Download Driver →
              </a>
            ) : (
              <p class="text-sm text-[--color-text-muted]">{data.driver.windows}</p>
            )}
          </div>
          <div class="bg-[--color-bg-tertiary] rounded-xl p-4">
            <h4 class="font-medium text-[--color-text-primary] mb-2">macOS</h4>
            {data.driver.mac.startsWith('http') ? (
              <a href={data.driver.mac} target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline text-sm">
                Download Driver →
              </a>
            ) : (
              <p class="text-sm text-[--color-text-muted]">{data.driver.mac}</p>
            )}
          </div>
          <div class="bg-[--color-bg-tertiary] rounded-xl p-4">
            <h4 class="font-medium text-[--color-text-primary] mb-2">Linux</h4>
            <p class="text-sm text-[--color-text-muted]">{data.driver.linux}</p>
          </div>
        </div>
      </div>

      <!-- Flasher Links -->
      <div class="bg-[--color-bg-secondary] border border-[--color-border] rounded-2xl p-8 mb-8">
        <h2 class="text-2xl font-bold text-[--color-text-primary] mb-4">
          Step 3: Flash Firmware
        </h2>
        <p class="text-[--color-text-secondary] mb-6">
          Open the web flasher for your chosen firmware in Chrome or Edge browser:
        </p>
        <div class="grid sm:grid-cols-2 gap-4">
          <a
            href={data.flasher.meshcore}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-4 p-5 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 rounded-xl transition-colors"
          >
            <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <div>
              <h3 class="font-semibold text-[--color-text-primary]">MeshCore Flasher</h3>
              <p class="text-sm text-[--color-text-muted]">flasher.meshcore.co.uk</p>
            </div>
          </a>
          <a
            href={data.flasher.meshtastic}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-4 p-5 bg-green-500/10 hover:bg-green-500/20 border border-green-500/30 rounded-xl transition-colors"
          >
            <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <div>
              <h3 class="font-semibold text-[--color-text-primary]">Meshtastic Flasher</h3>
              <p class="text-sm text-[--color-text-muted]">flasher.meshtastic.org</p>
            </div>
          </a>
        </div>
      </div>

      <!-- Post-Flash Configuration -->
      <div class="bg-[--color-bg-secondary] border border-[--color-border] rounded-2xl p-8 mb-8">
        <h2 class="text-2xl font-bold text-[--color-text-primary] mb-6">
          Step 4: Post-Flash Configuration
        </h2>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-blue-500/5 border border-blue-500/20 rounded-xl p-5">
            <h3 class="font-semibold text-blue-400 mb-4">MeshCore Setup</h3>
            <ul class="space-y-2">
              {data.postFlash.meshcore.map((step: string) => (
                <li class="flex items-start gap-2 text-sm text-[--color-text-secondary]">
                  <svg class="w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>{step}</span>
                </li>
              ))}
            </ul>
          </div>

          <div class="bg-green-500/5 border border-green-500/20 rounded-xl p-5">
            <h3 class="font-semibold text-green-400 mb-4">Meshtastic Setup</h3>
            <ul class="space-y-2">
              {data.postFlash.meshtastic.map((step: string) => (
                <li class="flex items-start gap-2 text-sm text-[--color-text-secondary]">
                  <svg class="w-4 h-4 text-green-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>{step}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <div class="mt-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl">
          <p class="text-sm text-yellow-200">
            <strong>US Users:</strong> Set frequency/region to 915 MHz (US). This ensures compatibility with the NodakMesh network and other US mesh networks!
          </p>
        </div>
      </div>

      <!-- Tips -->
      {data.tips && data.tips.length > 0 && (
        <div class="bg-[--color-bg-secondary] border border-[--color-border] rounded-2xl p-8 mb-8">
          <h2 class="text-2xl font-bold text-[--color-text-primary] mb-4">Tips & Notes</h2>
          <ul class="space-y-3">
            {data.tips.map((tip: string) => (
              <li class="flex items-start gap-3 text-[--color-text-secondary]">
                <svg class="w-5 h-5 text-[--color-accent] mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{tip}</span>
              </li>
            ))}
          </ul>
        </div>
      )}

      <!-- Navigation -->
      <div class="flex flex-wrap gap-4 justify-between">
        <a
          href="/meshcore/devices"
          class="inline-flex items-center gap-2 text-[--color-text-secondary] hover:text-[--color-text-primary] transition-colors"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          MeshCore Devices
        </a>
        <a
          href="/meshtastic/devices"
          class="inline-flex items-center gap-2 text-[--color-text-secondary] hover:text-[--color-text-primary] transition-colors"
        >
          Meshtastic Devices
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>

    </div>
  </main>
</Layout>
